{% extends '../../caretaker/includes/dashboardhome.html' %}
  {% load static %}
      {% block 'title' %}Caretaker||Incoming-Tickets {% endblock %}
                {% block 'body' %}
<div class="container-fluid">
    {% include 'includes/flash-messages.html' %}
    <div class="row" id="dashboardcustomer">
        <div class="col-4">
        <h3 id="customerDashboard">Incoming Tickets</h3>
            </div>
        <div class="col-8">

         <a class=" btn btn-dark top-button"  href="utilities-border.html">solved tickets</a>
         <a class="btn btn-dark top-button mr-1"  href="{% url 'assign_list' %}">assign Lists</a>
                </div>

    </div>
     <hr>
        <hr>
    {% if request.user.caretaker_status == "available" %}

    {% if ticketList %}
    <table class="table ">
        <thead class="thead-dark">
        <tr>
            <th scope="col">sn</th>
            <th scope="col">db_id</th>
            <th>subject</th>
            <th>decription</th>
            <th>Image</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for t in ticketList %}
        <tr>
            <td>{{forloop.counter}}</td>
            <td>{{t.id}}</td>
            <td>{{t.subject}}</td>
            {% autoescape off %}
            <td>{{t.description|truncatewords:5}} <a href="">Read More</a></td>
            {% endautoescape %}
             <td>{{t.created_by}}</td>
            {% if t.image %}
            <td>
                <img src="{{t.image.url}}" height="50" width="50" alt="">
            </td>
            {% else %}
            <td>
                empty image
                <img src="" alt="">
            </td>
            {% endif %}
            <td>
                <a href="{% url 'view_details' t.id %}" class="btn btn-primary rounded-circle"><i class="fa fa-eye "
                                                                                                  title="Details info"></i></a>
                <form action="{% url 'ticket_assign' %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" value="{{t.id}}" name="ticket">
                    <input type="hidden" value="{{request.user.id}}" name="caretaker">
                    <input type="hidden" value="{{t.created_by_id}}" name="customer">
                    <button type="submit"
                            onclick="return confirm('Are you sure want to assign  category')"
                            class="btn btn-success rounded-circle "><i class="fa fa-user-plus"
                                                                      data-toggle="tooltip" title="assign"></i></button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

     {% elif ticket_info %}
       <table class="table ">
        <thead class="thead-dark">
        <tr>
            <th scope="col">sn</th>
            <th scope="col">db_id</th>
            <th>subject</th>
            <th>decription</th>
            <th>created_by</th>
            <th>Image</th>
            <th>Action</th>
        </tr>
        </thead>
        <tbody>
        {% for t in ticket_info %}
        <tr>
            <td>{{forloop.counter}}</td>
            <td>{{t.id}}</td>
            <td>{{t.subject}}</td>
            {% autoescape off %}
            <td>{{t.description|truncatewords:5}} <a href="">Read More</a></td>
            {% endautoescape %}
            <td>{{t.created_by}}</td>
            {% if t.image %}

            <td>
                <img src="{{t.image.url}}" height="50" width="50" alt="">
            </td>
            {% else %}
            <td>
                empty image
                <img src="" alt="">
            </td>
            {% endif %}
            <td>
                <a href="{% url 'view_details' t.id %}" class="btn btn-primary rounded-circle"><i class="fa fa-eye "
                                                                                                  title="Details info"></i></a>
                <form action="{% url 'ticket_assign' %}" method="POST" class="d-inline">
                    {% csrf_token %}
                    <input type="hidden" value="{{t.id}}" name="ticket">
                    <input type="hidden" value="{{request.user.id}}" name="caretaker">
                    <input type="hidden" value="{{t.created_by_id}}" name="customer">
                    <button type="submit"
                            onclick="return confirm('Are you sure want to assign  category')"
                            class="btn btn-success rounded-circle "><i class="fa fa-user-plus"
                                                                      data-toggle="tooltip" title="assign"></i></button>
                </form>
            </td>
        </tr>
        {% endfor %}
        </tbody>
    </table>
    {% else %}
    <h4>Sorry! you have not issue a ticket yet </h4>
    {% endif %}
    {% else %}
    <h4>your are in busy state..To view the tickets you must change your status to available </h4>

    {% endif %}

</div>

            {% endblock %}
        {% block "script" %}
        {% endblock %}

